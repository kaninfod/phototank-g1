c
n
new_location
n
c
e
n
if similar_locations.count
similar_locations.count
n
similar_locations.count
similar_locations
n
similar_locations.first.location
@photo.location
@photo
n
s
n
c
where
help
e
n
e
n
e
n
@photo
n
c
n
c
default_render
n
@photos.count
Catalog.find(params[:id]).photos
photos.count
n
c
n
photo
Photo.last
c
n
photo
n
e
n
catalog
photo
c
n
photo_obj
c
photo_obj
c
photo_obj
$redis.get(0)
c
where
d
h
c
cc
c
$redis.get(0)
c
b
c
$redis.get(0)
photo
photo_obj.to_json
p
photo_obj
photo_obj.to_json
c
p
$redis.set objid, photo_obj.to_json
photo_obj.to_json
p
n
c
n
JSON.parse($redis.get(2))
          photo.status = 1
c
n
 photo_obj
n
b
sub_path
n
e
n
photo_obj 
n
c
e.message
e
n
photo_obj 
n
c
e
n
c
n
e
n
photo_obj
n
JSON.parse($redis.get(1))
c
photo_obj
photo_obj'
photo_obj
c
photo_obj
c
JSON.parse($redis.get(objid))
objid
photo_obj
c
photo_obj
e.message
e
n
e
n
e
n
c
n
c
n
photo.save
photo
n
Location.all
n
photo.location
photo
n
photo
n
similar_locations.first
similar_locations
n
photo
c
n
e
n
e
n
photo
n
c
n
c
similar_locations.to_sql
similar_locations
n
c
n
c
Photo.first.nearbys(1).where.not(location_id: nil)
Photo.first.nearbys(1).to_sql
Photo.first.nearbys(1).where.not(location_id ).to_sql
Photo.first.nearbys(1).where.not(location: nil)
Photo.first..nearbys(1).where.not(location: nil)
photo.nearbys(1).where.not(location: nil).to_sql
photo.nearbys(1).where.not(location: nil)
Photo.joins(:location).where(photo.id =1).to_sql
Photo.joins(:location).where(photo.id =1)
similar_locations.count
similar_locations
similar_locations = photo.nearbys(1).joins(:location).where.not(location: nil)
n
c
similar_locations.blank?
e
n
 photo.nearbys(1).joins(:location).where.not(location: nil)
c
n
c
photo.nearbys(1).joins(:location).where.not(location: nil).first
photo.nearbys(1).joins(:location).where.not(location: nil)
photo.nearbys(1).joins(:location).where.not(location: nil).to_sql
photo.nearbys(1).where.not(location: nil).to_sql
photo.nearbys(1).where.not(location: nil)
photo
photo.nearbys(1)
c
n
e
n
photo.nearbys(1)
e
n
photo
c
photo
c
photo
c
n
photo
n
photo
c
photo
e
n
e
n
q
similar_locations
c
similar_locations
c
similar_locations
n
c
photo
c
n
photo
n
photo
n
instance
n
instance
n
c
q
e
n
photo
exif.datetimeoriginal 
n
exif.datetimeoriginal.blank?
exif
n
q
c
n
q
n
File.file?(jpeg_file)
if File.file?(jpeg_file)
jpeg_file
c
